
{% extends "layout.njk" %}

{% set primaryNavId = 'profile' %}

{% set title = [user.profile.firstName, user.profile.lastName] | join(' ') %}

{% block beforeContent %}
  {{ govukBreadcrumbs({
    items: [{
      text: 'Profile',
      href: '/profile'
    }, {
      text: 'Preview'
    }]
  }) }}
{% endblock %}

{% block content %}

  {{ govukNotificationBanner({
    html: "<h2 class=\"govuk-heading-m\">"+flash+"</h2>",
    type: "success",
    icon: false
  }) if flash and flash.length }}

  <div class="govuk-grid-row ">
    <div class="govuk-grid-column-two-thirds">

      <h1 class="govuk-heading-xl govuk-!-margin-bottom-2">
        {{title}} {{govukTag({
          text: 'Looking for a role',
          classes: 'govuk-tag--green'
        }) if user.profile.status == 'Active'}}
      </h1>
      <p>
        Email address: <a href="mailto:{{user.emailAddress}}">{{user.emailAddress}}</a>
        {% if user.profile.phoneNumber %}
          | Phone number: {{user.profile.phoneNumber}}
        {% endif %}

      </p>

      {% if user.profile.about %}
        <div class="app-profile__section app-profile__section--first">
          <h2 class="govuk-heading-m govuk-!-font-size-27">
            About
          </h2>

          <p>{{user.profile.about | nl2br | safe }}</p>
        </div>
      {% endif %}

      {% if user.profile.qts or user.profile.ect %}
        <div class="app-profile__section">
          <h2 class="govuk-heading-m govuk-!-font-size-27">
            Teaching status
          </h2>

          {{ govukSummaryList({
            rows: [
              {
                key: {
                  text: "Qualified teacher status"
                },
                value: {
                  text: user.profile.qts
                }
              } if user.profile.qts,
              {
                key: {
                  text: "Early career teacher"
                },
                value: {
                  text: user.profile.ect
                }
              } if user.profile.ect
            ]
          }) }}
        </div>
      {% endif %}

      {% if user.profile.roles %}
        <div class="app-profile__section">
          <h2 class="govuk-heading-m govuk-!-font-size-27">
            Job preferences
          </h2>

          {{ govukSummaryList({
            rows: [
              {
                key: {
                  text: "Roles"
                },
                value: {
                  text: user.profile.roles
                }
              } if user.profile.roles,
              {
                key: {
                  text: "Phases"
                },
                value: {
                  text: user.profile.phases
                }
              } if user.profile.phases,
              {
                key: {
                  text: "Key stages"
                },
                value: {
                  text: user.profile.keyStages | join(', ')
                }
              } if user.profile.keyStages,
              {
                key: {
                  text: "Subjects"
                },
                value: {
                  text: user.profile.subjects
                }
              } if user.profile.subjects,
              {
                key: {
                  text: "Working patterns"
                },
                value: {
                  text: user.profile.workingPatterns
                }
              } if user.profile.workingPatterns
            ]
          }) }}
        </div>
      {% endif %}

      {% if user.profile.workHistory | length %}
        <div class="app-profile__section">

          <h2 class="govuk-heading-m govuk-!-font-size-27">
            Work history
          </h2>
          <div class="app-list">
            {% for id, role in user.profile.workHistory %}
              <div class="app-list__item {% if loop.first %}app-list__item--first{% endif %} {% if loop.last %}app-list__item--last{% endif %}">
                <h3 class="govuk-heading-s govuk-!-margin-top-0 govuk-!-margin-bottom-0">
                  {{role.employer}}
                </h3>
                <p class="govuk-!-margin-bottom-0 govuk-!-margin-top0">{{role.role}}</p>
                <p class="govuk-caption-m govuk-!-margin-bottom-0">
                  {{role.startDate | monthAndYearOnly}}
                  to
                  {% if role.endDate %}
                    {{role.endDate | monthAndYearOnly}}
                  {% else %}
                    present
                  {% endif %}
                </p>
                <p class="govuk-!-margin-top-2 govuk-!-margin-bottom-0">{{role.description | nl2br }}</p>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

      {{qualificationsGroup | log}}

      {% if user.profile.qualifications | length %}
        <div class="app-profile__section">
          <h2 class="govuk-heading-m govuk-!-font-size-27">
            Qualifications
          </h2>
          {% for key, type in qualificationsGroup %}
            <div class="app-qualification-group {% if loop.first %}app-qualification-group--first{% endif %} {% if loop.last %}app-qualification-group--last{% endif %}">
              <h3 class="govuk-heading-s govuk-!-margin-top-0 govuk-!-margin-bottom-1">
                {{key}}s
              </h3>

              {% for key, qualifications in type %}

                <div class="app-qualifications-group__org-year">

                  <p class="govuk-!-margin-bottom-1">
                    {% for qualification in qualifications %}
                      {{qualification.subject}}
                      {%- if qualification.grade %}
                        ({{qualification.grade}})
                      {%- else %}
                        {% if qualification.type == 'Degree' %}
                          (not finished yet)
                        {% endif %}
                      {%- endif %}
                      {%- if not loop.last %},{% endif%}
                    {% endfor %}
                  </p>

                  <p class="govuk-caption-m govuk-!-margin-bottom-0">
                    {{qualifications[0].organisation}}
                    {%- if qualifications[0].year -%}
                      , {{qualifications[0].year}}
                    {%- endif %}
                  </p>
                </div>

              {% endfor%}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>

{% endblock %}
