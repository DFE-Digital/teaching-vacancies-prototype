
{% extends "layout.njk" %}

{% set primaryNavId = 'profile' %}

{% set title = 'Your profile' %}

{% block content %}

  {{ govukNotificationBanner({
    html: "<h2 class=\"govuk-heading-m\">"+flash+"</h2>",
    type: "success",
    icon: false
  }) if flash and flash.length }}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

      <h1 class="govuk-heading-xl govuk-!-margin-bottom-4">
        {{title}}
        {{govukTag({
          text: user.profile.status,
          classes: 'govuk-tag--green'
        }) if user.profile.status == 'Active'}}
      </h1>


      {% if user.profile.status %}
        <p>
          {% if user.profile.status == 'Active' %}
            <a class="govuk-!-margin-right-2" href="/profile/deactivate">Turn off profile</a>
          {% else %}
            <a class="govuk-!-margin-right-2" href="/profile/activate">Turn on profile</a>
          {% endif %}
          <a href="/profile/preview">Preview profile</a></p>
        </p>
      {% endif %}
      <p>Your profile allows schools to find and invite you to apply for their jobs.</p>



      <div class="app-profile__section app-profile__section--first">

        <h2 class="govuk-heading-m govuk-!-font-size-27">
          Personal details
        </h2>

        {% if user.profile.firstName and user.profile.providePhoneNumber %}

          {% set emailAddress %}
            <p>{{user.emailAddress}}</p>

            {{ govukInsetText({
              classes: 'govuk-!-margin-top-3',
              html: 'Change your email address from within your <a href="#">account</a>.'
            }) }}

          {% endset %}

          {{ govukSummaryList({
            rows: [
              {
                key: {
                  text: "First name"
                },
                value: {
                  text: user.profile.firstName
                },
                actions: {
                  items: [
                    {
                      href: "/profile/personal-details/name",
                      text: "Change",
                      visuallyHiddenText: "First name"
                    }
                  ]
                }
              },
              {
                key: {
                  text: "Last name"
                },
                value: {
                  text: user.profile.lastName
                },
                actions: {
                  items: [
                    {
                      href: "/profile/personal-details/name",
                      text: "Change",
                      visuallyHiddenText: "Last name"
                    }
                  ]
                }
              },
              {
                key: {
                  text: "Email address"
                },
                value: {
                  html: emailAddress
                }
              },
              {
                key: {
                  text: "Do you want to provide a phone number?"
                },
                value: {
                  text: user.profile.providePhoneNumber
                },
                actions: {
                  items: [
                    {
                      href: "/profile/personal-details/phone-number",
                      text: "Change",
                      visuallyHiddenText: "Phone number"
                    }
                  ]
                }
              },
              {
                key: {
                  text: "Phone number"
                },
                value: {
                  text: user.profile.phoneNumber
                },
                actions: {
                  items: [
                    {
                      href: "/profile/personal-details/phone-number",
                      text: "Change",
                      visuallyHiddenText: "Phone number"
                    }
                  ]
                }
              } if user.profile.providePhoneNumber == 'Yes'
            ]
          }) }}
        {% else %}
          {# <p>Name and contact details.</p> #}
          {# {{ govukButton({
            text: "Add personal details",
            classes: 'govuk-button--secondar govuk-!-margin-bottom-2',
            href: '/profile/personal-details/name'
          }) }} #}
          <p><a href="/profile/personal-details/name">Add personal details</a></p>
        {% endif %}


      </div>
      <div class="app-profile__section">

        <h2 class="govuk-heading-m govuk-!-font-size-27">
          Job preferences
        </h2>

        {% set locations %}
          {% for key, location in user.profile.locations %}
            {{location.location}} ({{location.radius}})
            {%- if not loop.last -%}
            ,
            {%- endif -%}
          {% endfor %}
        {% endset %}

        {% if user.profile.roles and user.profile.phases and user.profile.workingPatterns %}
          {{ govukSummaryList({
          rows: [
            {
              key: {
                text: "Roles"
              },
              value: {
                html: user.profile.roles | join('<br><br>')
              },
              actions: {
                items: [
                  {
                    href: "/profile/job-preferences/roles",
                    text: "Change",
                    visuallyHiddenText: "Roles"
                  }
                ]
              }
            },
            {
              key: {
                text: "Phases"
              },
              value: {
                text: user.profile.phases | join(', ')
              },
              actions: {
                items: [
                  {
                    href: "/profile/job-preferences/education-phases",
                    text: "Change",
                    visuallyHiddenText: "Education phases"
                  }
                ]
              }
            } if user.profile.phases,
            {
              key: {
                text: "Key stages"
              },
              value: {
                text: user.profile.keyStages | join(', ')
              },
              actions: {
                items: [
                  {
                    href: "/profile/job-preferences/key-stages",
                    text: "Change",
                    visuallyHiddenText: "Key stages"
                  }
                ]
              }
            } if user.profile.keyStages,
            {
              key: {
                text: "Subjects"
              },
              value: {
                html: user.profile.subjects | join(', ')
              },
              actions: {
                items: [
                  {
                    href: "/profile/job-preferences/subjects",
                    text: "Change",
                    visuallyHiddenText: "Subjects"
                  }
                ]
              }
            } if user.profile.subjects,
            {
              key: {
                text: "Working patterns"
              },
              value: {
                text: user.profile.workingPatterns | join(', ')
              },
              actions: {
                items: [
                  {
                    href: "/profile/job-preferences/working-patterns",
                    text: "Change",
                    visuallyHiddenText: "Working patterns"
                  }
                ]
              }
            },
            {
              key: {
                text: "Locations"
              },
              value: {
                text: locations
              },
              actions: {
                items: [
                  {
                    href: "/profile/job-preferences/location-check",
                    text: "Change",
                    visuallyHiddenText: "Locations"
                  }
                ]
              }
            }
          ]
        }) }}
      {% else %}
        {# {{ govukButton({
          text: "Add job preferences",
          classes: 'govuk-button--secondar govuk-!-margin-bottom-2',
          href: '/profile/job-preferences/roles'
        }) }} #}
        <p><a href="/profile/job-preferences/roles">Add job preferences</a></p>
      {% endif %}
      </div>

      <div class="app-profile__section">


        <h2 class="govuk-heading-m govuk-!-font-size-27">
          Qualified teaching status (QTS)
        </h2>

        {% if user.profile.qts %}
          {{ govukSummaryList({
          rows: [
            {
              key: {
                text: "Do you have qualified teaching status (QTS)?"
              },
              value: {
                html: user.profile.qts
              },
              actions: {
                items: [
                  {
                    href: "/profile/teaching-status/qts",
                    text: "Change",
                    visuallyHiddenText: "if you have qualified teaching status (QTS)"
                  }
                ]
              }
            },
            {
              key: {
                text: "Year QTS awarded"
              },
              value: {
                text: user.profile.qtsAwardedYear
              },
              actions: {
                items: [
                  {
                    href: "/profile/teaching-status/qts",
                    text: "Change",
                    visuallyHiddenText: "Year QTS awarded"
                  }
                ]
              }
            } if user.profile.qtsAwardedYear
          ]
        }) }}
        {% else %}
          <p><a href="/profile/teaching-status/qts">Add qualified teaching status</a></p>
        {% endif %}
      </div>
      <div class="app-profile__section">

        <h2 class="govuk-heading-m govuk-!-font-size-27">
          Qualifications
        </h2>

        <p><a href="/profile/qualifications/type">Add qualifications</a></p>

        {% for id, qualification in user.profile.qualifications %}

          {{appPageHeader({
            classes: 'govuk-!-margin-bottom-1',
            heading: {
              level: 2,
              text: qualification.subject,
              classes: 'govuk-heading-m'
            },
            items: [{
              text: 'Delete qualification',
              href: "/profile/qualifications/"+id+"/delete",
              type: 'link'
            }]
          })}}

          {{ govukSummaryList({
            rows: [
              {
                key: {
                  text: "Type"
                },
                value: {
                  text: qualification.type
                },
                actions: {
                  items: [
                    {
                      href: "/profile/qualifications/"+id+"/type/",
                      text: "Change",
                      visuallyHiddenText: "Type"
                    }
                  ]
                }
              },
              {
                key: {
                  text: "Subject"
                },
                value: {
                  text: qualification.subject
                },
                actions: {
                  items: [
                    {
                      href: "/profile/qualifications/"+id+"/details/",
                      text: "Change",
                      visuallyHiddenText: "Item label"
                    }
                  ]
                }
              },
              {
                key: {
                  text: "Grade (optional)"
                },
                value: {
                  text: qualification.grade or 'Not entered'
                },
                actions: {
                  items: [
                    {
                      href: "/profile/qualifications/"+id+"/details/",
                      text: "Change",
                      visuallyHiddenText: "Item label"
                    }
                  ]
                }
              },
              {
                key: {
                  text: "Year awarded"
                },
                value: {
                  text: qualification.year or 'Not entered'
                },
                actions: {
                  items: [
                    {
                      href: "/profile/qualifications/"+id+"/details/",
                      text: "Change",
                      visuallyHiddenText: "Item label"
                    }
                  ]
                }
              },
              {
                key: {
                  text: "Organisation"
                },
                value: {
                  text: qualification.organisation or 'Not entered'
                },
                actions: {
                  items: [
                    {
                      href: "/profile/qualifications/"+id+"/details/",
                      text: "Change",
                      visuallyHiddenText: "Item label"
                    }
                  ]
                }
              }
            ]
          }) }}
        {% endfor %}
      </div>
      <div class="app-profile__section">

        <h2 class="govuk-heading-m govuk-!-font-size-27">
          Work history
        </h2>

        {# {{ govukButton({
          text: "Add work experience",
          classes: 'govuk-button--secondar govuk-!-margin-bottom-2',
          href: '#'
        }) }} #}

        <p><a href="/profile/work-history">Add roles</a></p>

        <div class="app-list">

        {% for id, role in user.profile.workHistory %}
          <div class="app-list__item">

            {{appPageHeader({
              classes: 'govuk-!-margin-bottom-0',
              heading: {
                level: 2,
                text: role.employer,
                classes: 'govuk-heading-s'
              },
              items: [{
                text: 'Change',
                href: "/profile/work-history/"+id+"/edit",
                type: 'link'
              }, {
                text: 'Delete role',
                href: "/profile/work-history/"+id+"/delete",
                type: 'link'
              }]
            })}}

            <p class="govuk-!-margin-bottom-0 govuk-!-margin-top0">{{role.role}}</p>
            <p class="govuk-caption-m govuk-!-margin-bottom-0">
              {{role.startDate | monthAndYearOnly}}
              to
              {% if role.endDate %}
                {{role.endDate | monthAndYearOnly}}
              {% else %}
                present
              {% endif %}
            </p>
            {# <p class="govuk-!-margin-top-2 govuk-!-margin-bottom-0">{{role.description | nl2br }}</p> #}
          </div>
        {% endfor %}
      </div>
      </div>
      <div class="app-profile__section">

        <h2 class="govuk-heading-m govuk-!-font-size-27">
          Experience
        </h2>

        {% if user.profile.about %}
          {{ govukSummaryList({
            rows: [
              {
                key: {
                  text: "Do you have experience teaching a key stage?"
                },
                value: {
                  html: user.profile.hasExperienceWithKeyStages
                },
                actions: {
                  items: [
                    {
                      href: "/profile/about/key-stages",
                      text: "Change",
                      visuallyHiddenText: "if you have experience teaching a key stage"
                    }
                  ]
                }
              },
              {
                key: {
                  text: "Key stages"
                },
                value: {
                  text: user.profile.experiencedKeyStages | join(', ')
                },
                actions: {
                  items: [
                    {
                      href: "/profile/about/key-stages",
                      text: "Change",
                      visuallyHiddenText: "Key stages"
                    }
                  ]
                }
              } if user.profile.hasExperienceWithKeyStages == 'Yes',
              {
                key: {
                  text: "Do you have experience teaching a subject?"
                },
                value: {
                  html: user.profile.hasExperienceWithSubjects
                },
                actions: {
                  items: [
                    {
                      href: "/profile/about/subjects",
                      text: "Change",
                      visuallyHiddenText: "if you have experience teaching a subject"
                    }
                  ]
                }
              },
              {
                key: {
                  text: "Subjects"
                },
                value: {
                  text: user.profile.experiencedSubjects | join(', ')
                },
                actions: {
                  items: [
                    {
                      href: "/profile/about/subjects",
                      text: "Change",
                      visuallyHiddenText: "subjects"
                    }
                  ]
                }
              } if user.profile.hasExperienceWithSubjects == 'Yes',
              {
                key: {
                  text: "About you"
                },
                value: {
                  html: user.profile.about | nl2br
                },
                actions: {
                  items: [
                    {
                      href: "/profile/about/about",
                      text: "Change",
                      visuallyHiddenText: "About you"
                    }
                  ]
                }
              }
            ]
          }) }}
        {% else %}
          <p><a href="/profile/about/key-stages">Add experience</a></p>
        {% endif %}
      </div>

      {% if not user.profile.status %}
        <div class="app-profile__section">
          <h2 class="govuk-heading-m govuk-!-font-size-27">
            Preview and turn on profile
          </h2>

          <p><a href="/profile/preview">Preview profile</a></p>

          <p>When you turn on your profile, it’ll be visible to hiring staff.</p>

          <form method="post">

            {{ govukButton({
              text: "Turn on profile"
            }) }}
          </form>
        </div>

      {% endif %}



    </div>
  </div>

{% endblock %}
