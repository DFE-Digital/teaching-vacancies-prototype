
{% extends "layout.njk" %}

{% set primaryNavId = 'jobs' %}

{% block content %}
  <h1 class="govuk-heading-xl govuk-!-margin-bottom-6">
    Jobs (<b id="numberOfJobs">24</b>)
  </h1>

  <p><a href="#" class="govuk-link--no-visited-state">Receive a job alert</a> whenever a job matching this search is listed.</p>

  <div class="app-filter-layout">
    <div class="app-filter-layout__filter">

      {% include "includes/jobs-filter-panel.njk" %}
    </div>

    <div class="app-filter-layout__content">
      {% include "includes/jobs-search-form.njk" %}

      <div class="app-action-bar">
        <div class="app-action-bar__filter"></div>
      </div>

      <div>
        <div class="app-jobs">

        {% if user.profile.roles %}  {% set userRoles =  user.profile.roles %}  {% else %}  {% set userRoles = '' %}  {% endif %}
        {% if user.profile.subjects %}  {% set userSubjects =  user.profile.subjects %}{% else %}  {% set userSubjects = '' %}{% endif %}
        {% if user.profile.phases %}  {% set userPhases =  user.profile.phases %}{% else %}  {% set userPhases = '' %}{% endif %}
        {% if user.profile.keyStages %}  {% set userStage =  user.profile.keyStages %}{% else %}  {% set userStage = '' %}{% endif %}
        {% if user.profile.workingPatterns %}  {% set userPattern =  user.profile.workingPatterns %}{% else %}  {% set userPattern = '' %}{% endif %}

        {% set userRoles = userRoles | string %}
        {% set userSubjects = userSubjects | string %}
        {% set userPhases = userPhases | string %}
        {% set userStage = userStage | string %}
        {% set userPattern = userPattern | string %}

        {% for job in jobs %}
        <!--
                {% if job.role in userRoles %}
                  YES IT'S A MATCH ROLE
                {% endif %}

                {% if job.subjects in userSubjects %}
                  YES IT'S A MATCH SUBJECTS
                {% endif %}

                {% if job.phase in userPhases %}
                  YES IT'S A MATCH PHASE
                {% endif %}

                {% if job.keyStages in userStage %}
                  YES IT'S A MATCH STAGE
                {% endif %}

                {% if userPattern in job.workingPatterns %}
                  YES IT'S A MATCH PATTERN
                {% endif %}

                <p>Role:{{userRoles}}: {{job.role}}</p>
                <p>Subject:{{userSubjects}}: {{job.subjects}}</p>
                <p>Phase:{{userPhases}}: {{job.phase}}</p>
                <p>Stage:{{userStage}}: {{job.keyStages}}</p>
                <p>Pattern:{{userPattern}}: {{job.workingPatterns}}</p>
        -->

          {% if ((job.role in userRoles) or (userRoles == '')) and ((job.subjects in userSubjects) or (userSubjects == '')) and ((job.phase in userPhases) or (userPhases == '')) and ((job.keyStages in userStage) or (userStage == '')) and ((userPattern in job.workingPatterns) or (userPattern == '')) %}


          {% set address %}
            {% for part, value in job.organisation.address %}
              {{value}}{% if not loop.last %}, {% endif %}
            {% endfor %}
          {% endset %}

          <div class="app-jobs__item">
            {% if job.organisation.logo != 'Not entered' %}
              <img src="{{job.organisation.logo}}" width="60" style="float: left; margin-right: 15px;">
            {% endif %}
            <h2 class="govuk-heading-m">
              <a href="/jobs/{{job.id}}">{{job.title}}</a>&nbsp;

              {% if job.isUsingApplicationForm == 'Yes' %}
              {{ govukTag({
                text: "Apply directly online",
                classes: 'govuk-tag--green'
              }) }}
              {% endif %}
            </h2>

            <p class="app-jobs__address">{{job.organisation.name}},{{address}}</p>

            {{ govukSummaryList({
              classes: 'govuk-summary-list--no-border app-summary-list--compact',
              rows: [
                {
                  key: {
                    text: "Role"
                  },
                  value: {
                    text: job.role
                  }
                },
                {
                  key: {
                    text: "Full-time equivalent salary"
                  },
                  value: {
                    html: job.fullTimeEquivalentSalaryDetails
                  }
                } if job.fullTimeEquivalentSalaryDetails,
                {
                  key: {
                    text: "Actual salary"
                  },
                  value: {
                    html: job.actualSalaryDetails
                  }
                } if job.actualSalaryDetails,
                {

                  key: {
                    text: "Pay scale"
                  },
                  value: {
                    html: job.payScaleDetails
                  }
                } if job.payScaleDetails,
                {
                  key: {
                    text: "Education phase"
                  },
                  value: {
                    text: job.phase | capitalize
                  }
                } if job.phase,
                {
                  key: {
                    text: "Working pattern"
                  },
                  value: {
                    text: job.workingPatterns | join(', ') | capitalize
                  }
                },
                {
                  key: {
                    text: "Subject"
                  },
                  value: {
                    html: job.subjects | join(', ') | capitalize
                  }
                } if job.subjects.length
              ]
            }) }}
          </div>



          {% else %}

          {% endif %}

        {% endfor %}
      </div>

      {{ govukPagination({
          next: {
            href: "#"
          },
          items: [
            {
              number: 1,
              href: "#",
              current: true
            },
            {
              number: 2,
              href: "#"
            },
            {
              number: 3,
              href: "#"
            }
          ]
        }) }}
    </div>
  </div>

  {# {{ govukDetails({
    summaryText: "Jobs by school, role, location and subject",
    text: "Text",
    classes: 'govuk-!-margin-top-8 govuk-!-margin-bottom-0'
  }) }} #}

{% endblock %}

{% block pageScripts %}
  <script src="/public/javascripts/components/filter-toggle-button/filter-toggle-button.js"></script>
  <script>
    new AppFrontend.FilterToggleButton({
      bigModeMediaQuery: '(min-width: 48.063em)',
      startHidden: false,
      toggleButton: {
        container: $('.app-action-bar__filter'),
        showText: 'Show filter',
        hideText: 'Hide filter',
        classes: 'govuk-button--secondary govuk-!-margin-bottom-3'
      },
      closeButton: {
        container: $('.app-filter__header-action'),
        text: 'Close'
      },
      filter: {
        container: $('.app-filter-layout__filter')
      }
    })

    new AppFrontend.CheckboxFilter({
      container: $('#subjects'),
      textBox: {
        label: 'Search for subject'
      }
    })


    var theCount = document.getElementsByClassName('app-jobs__item').length
    $("#numberOfJobs").html(theCount);


  </script>
{% endblock %}
